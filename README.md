# Настройка CI/CD

## Тесты

В этом репозитории находится пример приложения с тестами:

- [e2e тесты](e2e/example.spec.ts)
- [unit тесты](src/example.test.tsx)

Для запуска примеров необходимо установить [NodeJS](https://nodejs.org/en/download/) 16 или выше.

Как запустить:

```sh
# установить зависимости
npm ci

# запустить приложение
npm start
```

Как запустить e2e тесты:

```sh
# скачать браузеры
npx playwright install

# запустить тесты
npm run e2e
```

Как запустить модульные тесты:

```sh
npm test
```

## CI/CD

### Релизные скрипты

#### Как работает?

- При появлении тега на master отводиться от тега релизная ветка `release/<тег>`.
- Создается issue с changelog от предыдущего тега с названием `Release <тег> by <автор>`. 
- После запускаются проверки аналогичные PR. 
- Результат тестов можно будет увидеть в комментарии к релизному issue в виде ссылки на worflow. 
- Запускается build
- Запускается deploy
- Результат deploy'а можно будет увидеть в комментарии к релизному issue.
- Если ошибок не было, то issue закрывается.

- Если делать hotfix'ы в релизную ветку, тогда шаги будут аналогично вышеописанным, однако новый issue открываться не будет, лишь будет комментарий с новыми hotfix'ами.

#### Как проверить?

- Отвести от master тестовую ветку
- Сделать в нее commit (можно пустой)
- Сделать в github pr от этой ветки в master.
- Дождаться проверок (можно сломать какую то проверку).
- (Можно сделать еще один commit, проверки будут запускаться снова)
- Замержить ветку в master
- Обновить локальную ветку мастер.
- Поставить локально tag на master'е
- Отправить tag в репо (git push origin <тег>)
- Следить за релизом в https://github.com/TheMerret/shri2023-cicd/actions/workflows/release.yml.
- (Можно сделать hotfix в релизную ветку)
